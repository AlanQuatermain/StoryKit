{"sections":[],"metadata":{"role":"article","roleHeading":"Article","modules":[{"name":"StoryKit"}],"title":"Engine"},"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/storykit\/engine"]}],"identifier":{"url":"doc:\/\/StoryKit\/documentation\/StoryKit\/Engine","interfaceLanguage":"swift"},"hierarchy":{"paths":[["doc:\/\/StoryKit\/documentation\/StoryKit"]]},"abstract":[{"type":"text","text":"Drive the story forward with the actor‑based runtime."}],"kind":"article","schemaVersion":{"minor":3,"patch":0,"major":0},"primaryContentSections":[{"kind":"content","content":[{"type":"heading","level":2,"text":"Overview","anchor":"Overview"},{"inlineContent":[{"type":"text","text":"The Engine module provides "},{"code":"Engine\/StoryEngine","type":"codeVoice"},{"type":"text","text":" — a Swift "},{"code":"actor","type":"codeVoice"},{"type":"text","text":" that executes transitions, evaluates predicates, applies effects, and triggers autosave."}],"type":"paragraph"},{"inlineContent":[{"code":"Engine\/StoryEngine","type":"codeVoice"},{"type":"text","text":" is generic over your app’s "},{"code":"Core\/StoryState","type":"codeVoice"},{"type":"text","text":" so you can model state that fits your rules."}],"type":"paragraph"},{"type":"heading","level":2,"text":"Key Types","anchor":"Key-Types"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"Engine\/StoryEngine"},{"type":"text","text":": The main controller."}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"Engine\/EngineError"},{"type":"text","text":": Errors for unknown nodes\/choices or blocked selections."}]}]}],"type":"unorderedList"},{"type":"heading","level":2,"text":"Initialization","anchor":"Initialization"},{"inlineContent":[{"type":"text","text":"Initialize the engine with a loaded "},{"code":"Core\/Story","type":"codeVoice"},{"type":"text","text":", your initial state, registries, and an optional autosave handler:"}],"type":"paragraph"},{"type":"codeListing","code":["let engine = StoryEngine(","    story: story,","    initialState: MyState(currentNode: story.start),","    predicateRegistry: preds,","    effectRegistry: effs,","    actionRegistry: acts,","    autosave: { state in try await provider.save(slot: \"autosave\", snapshot: .init(storyID: story.metadata.id, state: state)) }",")"],"syntax":"swift"},{"type":"heading","level":2,"text":"Flow API","anchor":"Flow-API"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"Engine\/StoryEngine\/currentNode()"},{"type":"text","text":": Returns the current node, if available."}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"Engine\/StoryEngine\/availableChoices()"},{"type":"text","text":": Filters choices by evaluating registered predicates."}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"Engine\/StoryEngine\/select(choiceID:)"},{"type":"text","text":": Applies choice effects, transitions to the destination, applies destination on‑enter effects, then invokes autosave."}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"Engine\/StoryEngine\/performAction(id:parameters:)"},{"type":"text","text":": Invokes a registered action, allows state mutation, then invokes autosave."}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"Engine\/StoryEngine\/performGlobalAction(id:)"},{"type":"text","text":": Transitions to a globally declared action’s destination and applies on‑enter effects, then autosaves."}]}]}],"type":"unorderedList"},{"inlineContent":[{"type":"text","text":"All engine methods are isolated to the actor, ensuring thread safety."}],"type":"paragraph"}]}],"references":{"doc://StoryKit/documentation/StoryKit":{"identifier":"doc:\/\/StoryKit\/documentation\/StoryKit","title":"StoryKit","type":"topic","kind":"symbol","role":"collection","abstract":[],"url":"\/documentation\/storykit"}}}